<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
<link rel="stylesheet" href="ministries.css">

<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>
<script src="http://dev.stpatrickcolumbus.org/templates/joomspirit_99/organizationInfo.js"></script>

<div class="container-fluid">
    <div class="row">
        <div id="breadcrumbs">
            The breadcrumbs go here
        </div>
        <h1 id="ministryName">Ministry Name</h1>
    </div>
    <div class="row">
        <div class="col-xs-12">
            <div class="row" style="text-align: center;">
                <img src="https://columbusfrassatisociety.files.wordpress.com/2018/10/dsc09911_2.jpg?w=2500&h=" style="max-height: 400px;">
            </div>
            <div class="row" style="margin-top: 15px;">
                <div id="mission">
                    <strong>Mission:</strong>
                </div>
            </div>
            <div class="row">
                <div class="col-xs-8 col-xs-offset-2">
                    <h4 style="text-align: center;">Quick Facts</h4>
                    <div class="well">
                        <div id="audience">
                            <strong>Who:</strong>
                        </div>
                        <div id="numMembers">
                            <strong>Current Membership:</strong>
                        </div>
                        <div id="categories">
                            <strong>Category: </strong>
                        </div>
                    </div>
                </div>
            </div>
            <div class="row">
                <div id="history">
                    <strong>History: </strong>
                </div>
                <div id="regActivities">
                    <strong>Activities: </strong>
                </div>
                <div id="regMeetings">
                    <strong>Meetings: </strong>
                </div>
                <div id="fundraisers">
                    <strong>Fundraisers: </strong>
                </div>
                <div id="specialEvents">
                    <strong>Special Events: </strong>
                </div>
            </div>
            </div>
        </div>
    </div>
    <div class="row">
        <div class="col-xs-8 col-xs-offset-2">
            <h4 style="text-align: center;">Getting Involved</h2>
            <div class="well">
                <div id="hrsPerMonth">
                    <strong>Time Commitment: </strong>
                </div>
                <div class="row" style="padding: 5px 10px;">
                    <div id="skillsNeeded">
                        <strong>Helpful Skills: </strong>
                    </div>
                </div>
                <div id="prereqs">
                    <strong>Prerequisites: </strong>
                </div>
                <div id="keyDates">
                    <strong>Key Dates: </strong>
                </div>
                <div id="contactPerson">
                    <strong>Contact: </strong>
                </div>
                <div id="email">
                    <strong>Email: </strong>
                </div>
                <div id="website">
                    <strong>Website: </strong>
                </div>
                <div id="facebook">
                    <strong>Facebook Page: </strong>
                </div>
            </div>
        </div>
    </div>
</div>

<script>

    function getSearchParams(k){
        var p={};
        location.search.replace(/[?&]+([^=&]+)=([^&]*)/gi,function(s,k,v){p[k]=v})
        return k?p[k]:p;
    }

    ministries = JSON.parse(data)
    ministryName = getSearchParams("group");

    ministries.forEach(function(m) {
        console.log(m["urlVar"]);
        if(m["urlVar"] == ministryName) {
            ministry = m
        }
    });


    if($(".page-header a")[0]) {
        $(".page-header").remove();
        $(".actions").remove();
    }
    $("#ministryName").text(ministry["ministryName"]);

    var categories = ministry["category"].split(", ");
    categories.forEach(function(cat) {
        $("#categories").append('<span class="label label-default" style="margin: 2px; display: inline-block">' + cat + "</span>")
    });

    var pMinistryAttributes = ["mission", "history", "regActivities", "fundraisers", "regMeetings", "specialEvents"];
    pMinistryAttributes.forEach(function(key) {
        if(ministry[key]) {
            $("#" + key).append('<p>' + ministry[key] + "</p>")
        } else {
            $("#" + key).html("");
        }
    });

    var spanMinistryAttributes = ["contactPerson", "phone", "hrsPerMonth", "numMembers", "prereqs", "keyDates", "audience"];
    spanMinistryAttributes.forEach(function(key) {
            if(ministry[key]) {
                $("#" + key).append('<span>' + ministry[key] + "</span>")
            } else {
                $("#" + key).html("");
        }
    });

    var linkMinistryAttributes = ["website", "facebook"];
    linkMinistryAttributes.forEach(function(link) {
            if(ministry[link]) {
                $("#" + link).append('<a href="' + ministry[link] + '">' + ministry[link].replace("https://", "").replace(/\/+$/, "") + '</a>');
            } else {
                $("#" + link).html("");
        }
    });

    if(ministry["hrsPerMonth"] && !isNaN(ministry["hrsPerMonth"])) {
        $("#hrsPerMonth").append(" hours a month");
    }

    if(ministry["skillsNeeded"]) {
        ministry["skillsNeeded"].split(", ").forEach(function(skill) {
            $("#skillsNeeded").append('<span class="label label-default" style="display: inline-block; margin: 2px;" >' + skill + "</span>")
        });
    } else {
        $("skillsNeeded").html("");
    }

    // $("#contact").html("<strong>Contact:</strong> " + ministry["contact"]);
    ministry["email"] = ministry["email"].replace("%", "@").replace("!", ".");
    $("#email").html("<strong>Email:</strong> <a href='mailto:" + ministry["email"] + "'>" + ministry["email"] +"</a>");

    header = ministry["header"];
    if(header == "pray" || header == "pray") {
        theme = "Come to the Supper of the Lamb";
    } else {
        theme = "Bring Christ to a Hungry World";
    }

    $("#breadcrumbs").html(theme + " >> " + header.charAt(0).toUpperCase() + header.slice(1))

</script>